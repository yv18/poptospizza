<!-- -- Group 4
    // -- Yashraj Kishorsinh Raj --8890305
    // -- Krutikkumar Manishkumar patel --8890281
    // -- Dhruv Raheshbhai Patel --8875613
    // -- Rutvik italiya --8898924
    //--  Gurkirat Singh -- 8901247 -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
     <!-- NavBar -->
     <header>
        <nav class="NavBar">
            <div id="logo"></div>
            <div class="title">
                <h2>POPTOS</h2>
             </div>
            <ul>
                <li><a href="" id="Active">Invoice</a></li>
                <li><a href="/update">Update</a></li>
            </ul>
        </nav>
      </header>

    <div class="container mt-4 mb-5">
        <div class="row">
        <div class="col-md-8">
        <h3 class="mb-3">Instant Cook Pizzas</h3>
        <ul class="list-group">
            <% readyToEatPizza.forEach(pizza => { %>
            <li
            class="list-group-item d-flex justify-content-between align-items-center"
            onclick="addItemToSelected(`<%= pizza['Pizza Name'] %>`, `<%= pizza['R_Pizza_Price'] %>`);"
            >
            <%= pizza['Pizza Name'] %>
            <span class="badge bg-primary rounded-pill"
                >Rs <%= pizza['R_Pizza_Price'] %></span
            >
            </li>
            <% }); %>
        </ul>

        <h3 class="mt-4 mb-3">Pizzas</h3>
        <ul class="list-group">
            <% pizzas.forEach(pizza => { %>
            <li
            class="list-group-item d-flex justify-content-between align-items-center"
            onclick="addItemToSelected(`<%= pizza['Size'] %> <%= pizza['Pizza Crust Type'] %> with <%=
            pizza['Pizza Cheese Type'] %> cheese and <%= pizza['Pizza Sauce Type']
            %>`, `<%= pizza['Pizza_Price'] %>`);"
            >
            <%= pizza['Size'] %> <%= pizza['Pizza Crust Type'] %> with <%=
            pizza['Pizza Cheese Type'] %> cheese and <%= pizza['Pizza Sauce Type']
            %>
            <span class="badge bg-primary rounded-pill"
                >Rs <%= pizza['Pizza_Price'] %></span
            >
            </li>
            <% }); %>
        </ul>

        <h3 class="mt-4 mb-3">Toppings</h3>
        <ul class="list-group">
            <% toppings.forEach(topping => { %>
            <li
            class="list-group-item d-flex justify-content-between align-items-center"
            onclick="addItemToSelected(`<%= topping['Topping Name'] %>`, `<%= topping['price'] %>`);"
            >
            <%= topping['Topping Name'] %>
            <span class="badge bg-primary rounded-pill"
                >Rs <%= topping.price %></span
            >
            </li>
            <% }); %>
        </ul>

        <h3 class="mt-4 mb-3">Sides</h3>
        <ul class="list-group">
            <% sides.forEach(side => { %>
            <li
            class="list-group-item d-flex justify-content-between align-items-center"
            onclick="addItemToSelected(`<%= side['Side Name'] %>`, `<%= side['Sides_price'] %>`);"
            >
            <%= side['Side Name'] %>
            <span class="badge bg-primary rounded-pill"
                >Rs <%= side['Sides_price'] %></span
            >
            </li>
            <% }); %>
        </ul>
        </div>

        <div class="col-md-4">
            <h3 class="mb-3">Selected Items</h3>
            <ul id="selectedItemsList" class="list-group">
                <!-- Selected items will be automatically added here -->
            </ul>
            <hr/>
            <h6 class="mt-3">Total: Rs <span id="totalPrice">0.00</span></h6>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Checkout
            </button>

            
            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Select Shopper</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="shopperSelect" class="form-label">Select Shopper </label>
                            <select class="form-select" id="shopperSelect">
                                <% shoppers.forEach(shopper => { %>
                                <option 
                                    value="<%= shopper['Shopper ID'] %>"
                                    data-name="<%= shopper['Name'] %>"
                                    data-address="<%= shopper['Address'] %>"
                                    data-phone="<%= shopper['Phone Number'] %>"
                                    data-email="<%= shopper['Email'] %>"
                                ><%= shopper.Name %></option>
                                <% }); %>
                            </select>
                            
                        </div>        

                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="invoice-btn">Get Invoice</button>
                    </div>
                </div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
<footer class="bg-light text-center ">
    <!-- Grid container -->
    <div class="container p-4">
  
  
  
      <!-- Section: Text -->
      <section class="mb-4">
        <p> Yashraj Kishorsinh Raj --8890305</p>
        <p> Krutikkumar Manishkumar patel --8890281</p>
        <p> Dhruv Raheshbhai Patel --8875613</p>
        <p> Rutvik italiya --8898924</p>
        <p> Gurkirat Singh -- 8901247</p>
      </section>
      <!-- Section: Text -->
  
  
    </div>
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2)">
      Â© 2023 Copyright:
      <a class="text-dark" href="https://poptos.com/">POPTOS.com</a>
    </div>
  </footer>
  <!-- Footer -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        
        const invoiceBtn = document.getElementById('invoice-btn');
        
        invoiceBtn.addEventListener('click', ()=>{
            generateInvoice();
        });
        
        function generateInvoice() {
            const shopper = document.getElementById('shopperSelect');
            const selected = shopper.options[shopper.selectedIndex];
        

            const encodedName = encodeURIComponent(selected.getAttribute('data-name'));
            const encodedEmail = encodeURIComponent(selected.getAttribute('data-email'));
            const encodedAddress = encodeURIComponent(selected.getAttribute('data-address'));
            const encodedPhone = encodeURIComponent(selected.getAttribute('data-phone'));
            const encodedItems = encodeURIComponent(JSON.stringify(selectedItems));

    
            const url = `/generate-invoice?shopperName=${encodedName}&shopperEmail=${encodedEmail}&shopperAddress=${encodedAddress}&shopperPhone=${encodedPhone}&selectedItems=${encodedItems}`;
            window.open(url, "_blank");
        }
    </script>
    <script>
      const selectedItems = [];

      function addItemToSelected(itemName, itemPrice) {
        selectedItems.push({ name: itemName, price: itemPrice });
        updateSelectedItemsList();
      }

        function removeItemFromSelected(index) {
            selectedItems.splice(index, 1);
            updateSelectedItemsList();
        }

        function updateSelectedItemsList() {
            const selectedItemsList = document.getElementById('selectedItemsList');
            selectedItemsList.innerHTML = ''; // Clear previous content
            const totalPriceSpan = document.getElementById('totalPrice');
            let total = 0;

            selectedItems.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item d-flex align-items-center justify-content-between';
                listItem.innerHTML = `
                    ${item.name} - Rs ${item.price} <button class="btn-close btn-sm" onclick="removeItemFromSelected(${index})"></button>
                `;
                selectedItemsList.appendChild(listItem);
                console.log(total)
                if(isFinite(item.price)){
                    total += +item.price;
                }
            });
            totalPriceSpan.textContent = total;
        }
        
        
    </script>
  </body>
</html>
